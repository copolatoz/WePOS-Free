/**
 * Filename: billing.listPaidBilling.js
 * Generated 2020-01-14 at 01:35:18 PM
 */
Ext.define('ExtApp.modules.billing.model.model_dataBilling',{extend:'Ext.data.Model',alias:'model_dataBilling',fields:[{name:'id',type:'int'},{name:'item_no',type:'int'},{name:'table_id',type:'string'},{name:'table_no',type:'string'},{name:'billing_id',type:'int'},{name:'billing_no',type:'string'},{name:'billing_no_show',type:'string'},{name:'billing_date',type:'string'},{name:'created_datetime',type:'string'},{name:'created_date',type:'string'},{name:'updated_date',type:'string'},{name:'payment_date',type:'string'},{name:'billing_status',type:'string'},{name:'billing_notes',type:'string'},{name:'total_pembulatan',type:'string'},{name:'total_billing',type:'string'},{name:'total_billing_display',type:'string'},{name:'total_billing_show',type:'string'},{name:'grand_total',type:'string'},{name:'grand_total_show',type:'string'},{name:'total_paid',type:'string'},{name:'total_paid_show',type:'string'},{name:'payment_id',type:'int'},{name:'payment_type_name',type:'string'},{name:'bank_id',type:'int'},{name:'bank_name',type:'int'},{name:'card_no',type:'string'},{name:'include_tax',type:'int'},{name:'tax_percentage',type:'string'},{name:'tax_total',type:'string'},{name:'tax_total_show',type:'string'},{name:'include_service',type:'int'},{name:'service_percentage',type:'string'},{name:'service_total',type:'string'},{name:'service_total_show',type:'string'},{name:'discount_id',type:'int'},{name:'discount_notes',type:'string'},{name:'discount_percentage',type:'string'},{name:'discount_price',type:'string'},{name:'discount_total',type:'string'},{name:'discount_total_show',type:'string'},{name:'total_discount_item',type:'string'},{name:'total_discount_billing',type:'string'},{name:'total_qty_order',type:'int'},{name:'total_qty_deliver',type:'int'},{name:'order_total',type:'string'},{name:'order_total_show',type:'string'},{name:'total_hpp',type:'string'},{name:'total_hpp_show',type:'string'},{name:'total_profit',type:'string'},{name:'total_profit_show',type:'string'},{name:'percent_status_order',type:'string'},{name:'user_fullname',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'payment_note',type:'string'},{name:'is_half_payment',type:'int'},{name:'total_dp',type:'string'},{name:'total_dp_show',type:'string'},{name:'compliment_total',type:'string'},{name:'compliment_total_show',type:'string'},{name:'total_cash',type:'string'},{name:'total_cash_show',type:'string'},{name:'total_credit',type:'string'},{name:'total_credit_show',type:'string'},{name:'createdby',type:'string'},{name:'updatedby',type:'string'},{name:'merge_id',type:'int'},{name:'merge_billing_no',type:'string'},{name:'merge_main_status',type:'int'},{name:'split_from_id',type:'int'},{name:'split_merge_status',type:'string'},{name:'max_pembulatan',type:'int'},{name:'pembulatan_keatas',type:'int'},{name:'total_guest',type:'int'},{name:'sales_id',type:'int'},{name:'sales_percent',type:'string'},{name:'sales_price',type:'string'},{name:'sales_type',type:'string'},{name:'sales_name_company_fee',type:'string'},{name:'lock_billing',type:'int'},{name:'qc_notes',type:'string'},{name:'voucher_no',type:'string'},{name:'is_sistem_tawar',type:'int'},{name:'single_rate',type:'int'},{name:'customer_id',type:'int'},{name:'customer_name',type:'string'},{name:'block_table',type:'int'},{name:'is_reservation',type:'int'},{name:'group_date',type:'string'},{name:'txmark',type:'string'},{name:'txmark_no',type:'string'},{name:'txmark_no_show',type:'string'},{name:'payment_note2',type:'string'},],proxy:{type:'ajax',url:appUrl+'billing/dataBilling/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.billing.store.store_dataBilling',{extend:'Ext.data.Store',model:'ExtApp.modules.billing.model.model_dataBilling',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.billing.view.listPaidBilling",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var v_this=this;var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var store_listPaidBilling=theApp.getStore('store_listPaidBilling',false);if(store_listPaidBilling==false){store_listPaidBilling=theApp.copyStore('billing','store_dataBilling','store_listPaidBilling');}
store_listPaidBilling.proxy.extraParams.billing_status='paid';store_listPaidBilling.proxy.extraParams.is_peruser=0;store_listPaidBilling.proxy.extraParams.skip_date=0;store_listPaidBilling.proxy.extraParams.use_payment_date=0;store_listPaidBilling.proxy.extraParams.use_range_date=1;var selModel_listPaidBilling=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){}}});return desktop.createWindow({id:me.id,title:'List Paid Billing',width:850,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,border:0,layout:{type:'border'},items:[{xtype:'form',title:'Filter',width:330,region:'west',id:'form_filter_listPaidBilling',split:true,collapsible:true,splitterResize:false,collapseMode:'mini',animCollapse:true,scroll:false,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'textfield',name:'keywords',labelWidth:60,labelSeparator:'',emptyText:'Keywords: Billing No, Product Order',anchor:'100%',margin:'0 0 15 0',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_listPaidBilling();}}}},{xtype:'checkbox',name:'by_product_order',fieldLabel:'Search By Product Order',inputValue:'1',labelWidth:150,margin:'0 0 10 0',listeners:{change:function(field,e){var form=Ext.getCmp('form_filter_listPaidBilling').getForm();var keywords=form.findField('keywords').getValue();var by_product_order=form.findField('by_product_order').getSubmitValue();var use_range_date=form.findField('use_range_date').getSubmitValue();if(!use_range_date){use_range_date=0;}
if(!by_product_order){by_product_order=0;}
if(by_product_order==1){if(use_range_date==0){ExtApp.Msg.warning('Please use range period (checked) to use this filter<br/>This filter may load huge data of billing detail!');}
if(keywords==''){ExtApp.Msg.warning('Please type a keyword to use this filter');}}}}},{xtype:'checkbox',name:'use_range_date',fieldLabel:'Use Range Period',inputValue:'1',labelWidth:150,checked:true,margin:'0 0 10 0'},{xtype:'panel',border:0,layout:{type:'column'},margin:'0 0 15 0',items:[{xtype:'datefield',fieldLabel:'Date From',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:170,value:phpJs.date('d-m-Y'),allowBlank:false},{xtype:'datefield',fieldLabel:' To ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:125,value:phpJs.date('d-m-Y'),allowBlank:false}]},{xtype:'container',style:'text-align:right',border:0,items:[{xtype:'button',text:'Search',scale:'medium',margin:'15 0 0 0',itemId:'btnFilterSearch_listPaidBilling',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_listPaidBilling();}},{xtype:'button',text:'Reset',scale:'medium',margin:'15 60 0 10',itemId:'btnFilterReset_listPaidBilling',tooltip:'Reset',iconCls:'btn-reset',handler:function(){var form=Ext.getCmp('form_filter_listPaidBilling').getForm();form.reset();form.findField('keywords').setValue('');form.findField('date_from').setValue(phpJs.date('01-m-Y'));form.findField('date_till').setValue(phpJs.date('t-m-Y'));me.search_listPaidBilling();}}]}]},{xtype:'gridpanel',region:'center',border:0,multiSelect:true,id:'grid_listPaidBilling',store:store_listPaidBilling,scroll:true,selModel:selModel_listPaidBilling,columns:[{xtype:'gridcolumn',dataIndex:'billing_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'order_total',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'order_total_hpp',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'updated_date',text:'PAYMENT DATE',width:120},{xtype:'gridcolumn',dataIndex:'table_no',text:'TABLE',width:60},{xtype:'gridcolumn',dataIndex:'billing_no',text:'BILLING NO',width:100},{xtype:'gridcolumn',dataIndex:'total_qty_order',text:'QTY<br/>ORDER',width:70,align:'center'},{xtype:'gridcolumn',dataIndex:'total_billing_show',text:'TOTAL BILLING',width:120,align:'right'},{xtype:'gridcolumn',dataIndex:'tax_total_show',text:'TAX',width:100,align:'right'},{xtype:'gridcolumn',dataIndex:'service_total_show',text:'SERVICE',width:100,align:'right'},{xtype:'gridcolumn',dataIndex:'discount_total_show',text:'DISCOUNT',width:100,align:'right'},{xtype:'gridcolumn',dataIndex:'total_dp_show',text:'DP',width:100,align:'right'},{xtype:'gridcolumn',dataIndex:'grand_total_show',text:'GRANT TOTAL',width:120,align:'right'},{xtype:'gridcolumn',dataIndex:'total_cash_show',text:'PAID BY CASH',width:120,align:'right'},{xtype:'gridcolumn',dataIndex:'total_credit_show',text:'PAID BY CREDIT',width:120,align:'right'},{xtype:'gridcolumn',dataIndex:'compliment_total_show',text:'COMPLIMENT',width:120,align:'right'},{xtype:'gridcolumn',dataIndex:'updatedby',text:'CASHIER',width:120,align:'left'}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_listPaidBilling').getSelectionModel().selected;if(getSelection.length>0){me.data_billing=rec.data;me.createWindow(me,'show_listPaidBilling');}}},bbar:helperGrid.paging({ds:store_listPaidBilling,title:'Hold Billing'}),dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Filter',itemId:'filterButton_listPaidBilling',tooltip:'Filter List Hold Billing',iconCls:'btn-search',listeners:{click:function(){Ext.getCmp('form_filter_listPaidBilling').toggleCollapse();}}},'->',{text:'Print Billing Cashier',itemId:'printBillingButton_listPaidBilling',tooltip:'Print Billing Cashier',iconCls:'btn-print',handler:function(){var getSelection=Ext.getCmp('grid_listPaidBilling').getSelectionModel().selected;if(getSelection.length>0){me.setBilling_data=getSelection.items[0].data;me.printBillingConfirm_listPaidBilling();}else{ExtApp.Msg.info('Please Select Billing!');}}},'-',{text:'Refresh',itemId:'refreshButton_listPaidBilling',tooltip:'Refresh Data',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_listPaidBilling').store.load();}}]}]}],listeners:{boxready:function(){Ext.getCmp('form_filter_listPaidBilling').toggleCollapse();me.search_listPaidBilling();}}});},show_listPaidBilling:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Billing: '+me.data_billing.billing_no;var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var add_parameter='_dc='+phpJs.mktime();add_parameter+='&id='+me.data_billing.billing_id;var url_report=appUrl+'billing/dataBilling/show_listPaidBilling?'+add_parameter;return desktop.createWindow({id:me.id+'_show_listPaidBilling',title:Titletext,width:700,height:500,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:"component",id:'print_area_listPaidBilling',autoEl:{tag:"iframe",src:url_report},border:false}],buttons:[{text:'Print Via Cashier',scale:'medium',id:'btnPrintCashier_listPaidBilling',iconCls:'btn-print',handler:function(){var print_var={allID:me.data_billing.billing_id,allName:me.data_billing.billing_no};me.printBilling_listPaidBilling(print_var);}},{text:'Print',scale:'medium',id:'btnPrint_listPaidBilling',iconCls:'btn-print',handler:function(){me.print_listPaidBill(1);}},'->',{text:'Refresh',scale:'medium',itemId:'btnSearch_listPaidBilling',tooltip:'Search',iconCls:'btn-search',handler:function(){me.print_listPaidBill(0);}},{text:'Cancel',scale:'medium',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_show_listPaidBilling');}}],listeners:{show:function(){}}});}});