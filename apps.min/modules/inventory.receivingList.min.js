/**
 * Filename: inventory.receivingList.js
 * Generated 2019-09-12 at 05:04:25 AM
 */
Ext.define('ExtApp.modules.master_pos.model.model_masterItem',{extend:'Ext.data.Model',alias:'model_masterItem',fields:[{name:'id',type:'int'},{name:'item_code',type:'string'},{name:'item_sku',type:'string'},{name:'item_name',type:'string'},{name:'item_code_name',type:'string'},{name:'item_name_code',type:'string'},{name:'item_desc',type:'string'},{name:'item_manufacturer',type:'string'},{name:'sales_price',type:'string'},{name:'sales_price_show',type:'string'},{name:'item_price',type:'string'},{name:'item_price_show',type:'string'},{name:'item_hpp',type:'string'},{name:'item_hpp_show',type:'string'},{name:'last_in',type:'string'},{name:'last_in_show',type:'string'},{name:'total_qty_stok',type:'string'},{name:'item_type',type:'string'},{name:'item_type_name',type:'string'},{name:'item_image',type:'string'},{name:'item_image_show',type:'string'},{name:'item_image_src',type:'string'},{name:'category_id',type:'int'},{name:'item_category_name',type:'string'},{name:'item_category_code',type:'string'},{name:'subcategory_id',type:'int'},{name:'item_subcategory_name',type:'string'},{name:'item_subcategory_code',type:'string'},{name:'unit_id',type:'int'},{name:'unit_name',type:'string'},{name:'unit_code',type:'string'},{name:'supplier_id',type:'int'},{name:'supplier_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'use_for_sales',type:'int'},{name:'use_for_sales_text',type:'string'},{name:'id_ref_menu',type:'int'},{name:'sales_use_tax',type:'int'},{name:'sales_use_tax_text',type:'string'},{name:'sales_use_service',type:'int'},{name:'sales_use_service_text',type:'string'},{name:'is_kerjasama',type:'int'},{name:'is_kerjasama_text',type:'string'},{name:'persentase_bagi_hasil',type:'string'},{name:'total_bagi_hasil',type:'string'},{name:'total_bagi_hasil',type:'string'},{name:'total_bagi_hasil_show',type:'string'},{name:'use_stok_kode_unik',type:'int'},{name:'use_stok_kode_unik_text',type:'string'},{name:'min_stock',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterItem/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterUnit',{extend:'Ext.data.Model',alias:'model_masterUnit',fields:[{name:'id',type:'int'},{name:'unit_name',type:'string'},{name:'unit_code',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterUnit/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterStoreHouse',{extend:'Ext.data.Model',alias:'model_masterStoreHouse',fields:[{name:'id',type:'int'},{name:'storehouse_code',type:'string'},{name:'storehouse_name',type:'string'},{name:'storehouse_desc',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'is_primary',type:'int'},{name:'is_primary_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterStoreHouse/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.purchase.model.model_requestOrder',{extend:'Ext.data.Model',alias:'model_requestOrder',fields:[{name:'id',type:'int'},{name:'ro_number',type:'string'},{name:'ro_date',type:'string'},{name:'ro_memo',type:'string'},{name:'ro_from',type:'string'},{name:'ro_total_qty',type:'string'},{name:'ro_status',type:'string'},{name:'ro_status_text',type:'string'},{name:'divisi_id',type:'string'},{name:'divisi_name',type:'string'},{name:'total_item',type:'int'},{name:'total_request',type:'int'},{name:'total_validate',type:'int'},{name:'is_active',type:'string'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'purchase/requestOrder/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.purchase.model.model_purchaseOrder',{extend:'Ext.data.Model',alias:'model_purchaseOrder',fields:[{name:'id',type:'int'},{name:'po_number',type:'string'},{name:'supplier_id',type:'string'},{name:'supplier_name',type:'string'},{name:'supplier_invoice',type:'string'},{name:'po_date',type:'string'},{name:'po_date_txt',type:'string'},{name:'po_memo',type:'string'},{name:'po_total_qty',type:'string'},{name:'po_sub_total',type:'string'},{name:'po_sub_total_text',type:'string'},{name:'po_discount',type:'string'},{name:'po_discount_text',type:'string'},{name:'po_tax',type:'string'},{name:'po_tax_text',type:'string'},{name:'po_shipping',type:'string'},{name:'po_total_price',type:'string'},{name:'po_total_price_text',type:'string'},{name:'po_payment',type:'string'},{name:'payment_note',type:'string'},{name:'po_status',type:'string'},{name:'po_status_text',type:'string'},{name:'po_project',type:'string'},{name:'po_ship_to',type:'string'},{name:'createdby',type:'string'},{name:'is_active',type:'string'},{name:'is_active_text',type:'string'},{name:'used_on_receiving',type:'int'},{name:'po_number_rl_status',type:'string'},{name:'supplier_from_ro',type:'int'},{name:'use_approval',type:'int'},{name:'approval_status',type:'string'},{name:'approval_status_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'purchase/purchaseOrder/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.purchase.model.model_purchaseOrderDetail',{extend:'Ext.data.Model',alias:'model_purchaseOrderDetail',fields:[{name:'id',type:'string'},{name:'po_id',type:'string'},{name:'supplier_item_id',type:'string'},{name:'item_id',type:'string'},{name:'item_code',type:'string'},{name:'item_code_name',type:'string'},{name:'item_name',type:'string'},{name:'item_price',type:'string'},{name:'item_hpp',type:'string'},{name:'item_image',type:'string'},{name:'unit_id',type:'string'},{name:'unit_name',type:'string'},{name:'po_detail_qty',type:'string'},{name:'po_receive_qty',type:'string'},{name:'po_detail_status',type:'string'},{name:'po_detail_purchase',type:'string'},{name:'po_detail_purchase_show',type:'string'},{name:'po_detail_potongan',type:'string'},{name:'po_detail_potongan_show',type:'string'},{name:'po_detail_total',type:'string'},{name:'po_detail_total_show',type:'string'},{name:'po_receive_total',type:'string'},{name:'po_receive_total_show',type:'string'},{name:'ro_detail_id',type:'string'},{name:'ro_number',type:'string'},{name:'nomor',type:'int'}],proxy:{type:'ajax',url:appUrl+'purchase/purchaseOrder/gridDataDetail',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.purchase.model.model_purchaseOrderDetail_RL',{extend:'Ext.data.Model',alias:'model_purchaseOrderDetail_RL',fields:[{name:'id',type:'string'},{name:'receive_id',type:'string'},{name:'receive_number',type:'string'},{name:'supplier_item_id',type:'string'},{name:'item_id',type:'string'},{name:'item_id_real',type:'string'},{name:'item_code',type:'string'},{name:'item_code_name',type:'string'},{name:'item_name',type:'string'},{name:'item_price',type:'string'},{name:'item_image',type:'string'},{name:'unit_id',type:'string'},{name:'unit_name',type:'string'},{name:'receive_det_qty',type:'string'},{name:'receive_det_qty_before',type:'string'},{name:'receive_det_purchase',type:'string'},{name:'receive_det_purchase_show',type:'string'},{name:'po_detail_id',type:'string'},{name:'po_detail_qty',type:'string'},{name:'po_receive_qty',type:'string'},{name:'po_detail_qty_sisa',type:'string'},{name:'receive_det_date',type:'string'},{name:'receive_det_total',type:'string'},{name:'current_stock',type:'string'},{name:'use_stok_kode_unik',type:'string'},{name:'data_stok_kode_unik',type:'string'}],proxy:{type:'ajax',url:appUrl+'purchase/purchaseOrder/gridDataDetailRL',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_receivingList',{extend:'Ext.data.Model',alias:'model_receivingList',fields:[{name:'id',type:'int'},{name:'receive_number',type:'string'},{name:'supplier_id',type:'string'},{name:'storehouse_id',type:'string'},{name:'supplier_name',type:'string'},{name:'storehouse_name',type:'string'},{name:'no_surat_jalan',type:'string'},{name:'receive_date',type:'string'},{name:'receive_memo',type:'string'},{name:'total_qty',type:'string'},{name:'total_price',type:'string'},{name:'total_price_text',type:'string'},{name:'po_id',type:'string'},{name:'po_number',type:'string'},{name:'receive_status',type:'string'},{name:'receive_status_text',type:'string'},{name:'receive_project',type:'string'},{name:'receive_ship_to',type:'string'},{name:'createdby',type:'string'},{name:'is_deleted',type:'string'}],proxy:{type:'ajax',url:appUrl+'inventory/receivingList/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_receiveDetail',{extend:'Ext.data.Model',alias:'model_receiveDetail',fields:[{name:'id',type:'string'},{name:'receive_id',type:'string'},{name:'receive_number',type:'string'},{name:'supplier_item_id',type:'string'},{name:'item_id',type:'string'},{name:'item_id_real',type:'string'},{name:'item_code',type:'string'},{name:'item_code_name',type:'string'},{name:'item_name',type:'string'},{name:'item_price',type:'string'},{name:'item_image',type:'string'},{name:'unit_id',type:'string'},{name:'unit_name',type:'string'},{name:'receive_det_qty',type:'string'},{name:'receive_det_qty_before',type:'string'},{name:'receive_det_purchase',type:'string'},{name:'receive_det_purchase_show',type:'string'},{name:'po_detail_id',type:'string'},{name:'po_detail_qty',type:'string'},{name:'po_receive_qty',type:'string'},{name:'po_detail_qty_sisa',type:'string'},{name:'receive_det_date',type:'string'},{name:'current_stock',type:'string'},{name:'use_stok_kode_unik',type:'string'},{name:'data_stok_kode_unik',type:'string'}],proxy:{type:'ajax',url:appUrl+'inventory/receivingList/gridDataDetail',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.store.store_masterItem',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterItem',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterUnit',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterUnit',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterStoreHouse',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterStoreHouse',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.purchase.store.store_purchaseOrder',{extend:'Ext.data.Store',model:'ExtApp.modules.purchase.model.model_purchaseOrder',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.purchase.store.store_purchaseOrderDetail',{extend:'Ext.data.Store',model:'ExtApp.modules.purchase.model.model_purchaseOrderDetail',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.purchase.store.store_purchaseOrderDetail_RL',{extend:'Ext.data.Store',model:'ExtApp.modules.purchase.model.model_purchaseOrderDetail_RL',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.purchase.store.store_requestOrder',{extend:'Ext.data.Store',model:'ExtApp.modules.purchase.model.model_requestOrder',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_receivingList',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_receivingList',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_receiveDetail',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_receiveDetail',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.inventory.view.receivingList",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_receivingList_grid=theApp.getStore('inventory.store_receivingList');if(store_receivingList_grid==false){store_receivingList_grid=theApp.copyStore('inventory','store_receivingList','store_receivingList_grid');}
var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_receivingList=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_receivingList').down('#deleteButton_receivingList').setDisabled(selections.length==0);}}});me.pagingtb_receivingList=helperGrid.paging({ds:store_receivingList_grid,title:'Receiving List'});return desktop.createWindow({id:me.id,title:'Receiving List',width:850,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'border'},items:[{xtype:'form',title:'Filter',width:330,region:'west',id:'form_filter_receivingList',split:true,collapsible:true,splitterResize:false,collapseMode:'mini',animCollapse:true,scroll:false,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'textfield',name:'keywords',labelWidth:60,labelSeparator:'',emptyText:'Keywords: RL.NO / PO.NO / Supplier Name / Invoice',anchor:'100%',margin:'0 0 15 0',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_receivingList();}}}},{xtype:'panel',border:0,layout:{type:'column'},margin:'0 0 15 0',items:[{xtype:'datefield',fieldLabel:'Date From',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:170,value:phpJs.date('d-m-Y'),allowBlank:false},{xtype:'datefield',fieldLabel:' To ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:125,value:phpJs.date('d-m-Y'),allowBlank:false}]},{xtype:'container',style:'text-align:right',border:0,items:[{xtype:'button',text:'Search',scale:'medium',margin:'15 0 0 0',itemId:'btnFilterSearch_receivingList',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_receivingList();}},{xtype:'button',text:'Reset',scale:'medium',margin:'15 60 0 10',itemId:'btnFilterReset_receivingList',tooltip:'Reset',iconCls:'btn-reset',handler:function(){var form=Ext.getCmp('form_filter_receivingList').getForm();form.reset();form.findField('keywords').setValue('');form.findField('date_from').setValue(phpJs.date('d-m-Y'));form.findField('date_till').setValue(phpJs.date('d-m-Y'));me.search_receivingList();}}]}]},{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_receivingList_grid,id:'grid_receivingList',scroll:true,selModel:selModel_receivingList,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'po_id',text:'PO ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'supplier_id',text:'Supplier ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'receive_status',text:'Status Receive',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'receive_number',text:'RL.NO',width:90},{xtype:'gridcolumn',dataIndex:'po_number',text:'PO.NO',width:90},{xtype:'datecolumn',dataIndex:'receive_date',text:'Date',width:90,format:'d/m/Y'},{xtype:'gridcolumn',dataIndex:'supplier_name',text:'Supplier',width:150},{xtype:'gridcolumn',dataIndex:'receive_status_text',text:'Status',width:90},{xtype:'gridcolumn',dataIndex:'no_surat_jalan',text:'Surat Jalan',width:150},{xtype:'gridcolumn',dataIndex:'storehouse_name',text:'Warehouse',width:150},{xtype:'gridcolumn',dataIndex:'createdby',text:'User Input',width:120}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_receivingList').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_receivingList');}}},bbar:me.pagingtb_receivingList,dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Filter',itemId:'filterButton_recevingList',tooltip:'Filter Receiving List',iconCls:'btn-search',listeners:{click:function(){Ext.getCmp('form_filter_receivingList').toggleCollapse();}}},'->',{text:'Add',itemId:'addButton_receivingList',tooltip:'Add Receiving List',iconCls:'btn-add',handler:function(){me.formType='add';me.edit_data=[];me.createWindow(me,'add_receivingList');}},'-',{text:'Delete',itemId:'deleteButton_receivingList',tooltip:'Delete Receiving List',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_receivingList').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;var receive_status=me.delete_data.receive_status;if(me.delete_data.receive_status=='done'){ExtApp.Msg.warning('Cannot Delete '+me.delete_data.receive_number+'<br/>Receiving has been done');}else{me.deleteConfirm_receivingList();}}else{ExtApp.Msg.info('Please Select Receiving List!');}}},'-',{text:'Refresh',itemId:'refreshButton_receivingList',tooltip:'Refresh Receiving List',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_receivingList').store.load();}}]}]}],listeners:{boxready:function(){Ext.getCmp('form_filter_receivingList').toggleCollapse();me.search_receivingList();},show:function(){}}});},add_receivingList:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add New Receiving';if(me.formType=='edit'){Titletext='Update Receiving';me.store_receiveDetail=theApp.getStore('inventory.store_receiveDetail',false);me.store_receiveDetailTemp=theApp.copyStore('inventory','store_receiveDetail','store_receiveDetailTemp');}else{me.store_receiveDetail=theApp.getStore('purchase.store_purchaseOrderDetail_RL',false);me.store_receiveDetailTemp=theApp.copyStore('purchase','store_purchaseOrderDetail_RL','store_receiveDetailTemp');}
me.store_receiveDetailTemp.proxy.extraParams.limit=9999;var store_purchaseOrderAutocomplete_add_receivingList=theApp.getStore('store_purchaseOrderAutocomplete_add_receivingList',false);if(store_purchaseOrderAutocomplete_add_receivingList==false){store_purchaseOrderAutocomplete_add_receivingList=theApp.copyStore('purchase','store_purchaseOrder','store_purchaseOrderAutocomplete_add_receivingList');}
store_purchaseOrderAutocomplete_add_receivingList.proxy.extraParams.po_status='progress';store_purchaseOrderAutocomplete_add_receivingList.proxy.extraParams.skip_date=1;store_purchaseOrderAutocomplete_add_receivingList.proxy.extraParams.limit=9999;store_purchaseOrderAutocomplete_add_receivingList.proxy.extraParams.is_dropdown=1;store_purchaseOrderAutocomplete_add_receivingList.proxy.extraParams.is_rl=1;store_purchaseOrderAutocomplete_add_receivingList.proxy.extraParams.keywords='';var store_ComboboxMasterStoreHouse_receivingList=theApp.getStore('store_ComboboxMasterStoreHouse_receivingList',false);if(store_ComboboxMasterStoreHouse_receivingList==false){store_ComboboxMasterStoreHouse_receivingList=theApp.copyStore('master_pos','store_masterStoreHouse','store_ComboboxMasterStoreHouse_receivingList');}
store_ComboboxMasterStoreHouse_receivingList.proxy.extraParams.limit=999999;store_ComboboxMasterStoreHouse_receivingList.proxy.extraParams.is_dropdown=1;store_ComboboxMasterStoreHouse_receivingList.proxy.extraParams.except_primary=1;store_ComboboxMasterStoreHouse_receivingList.proxy.extraParams.is_active=1;store_ComboboxMasterStoreHouse_receivingList.proxy.extraParams.show_all_text=0;store_ComboboxMasterStoreHouse_receivingList.proxy.extraParams.show_choose_text=1;store_ComboboxMasterStoreHouse_receivingList.proxy.extraParams.keywords='';var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');return desktop.createWindow({id:me.id+'_add_receivingList',title:Titletext,width:800,height:550,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:true,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'panel',height:545,title:'',bodyPadding:5,items:[{xtype:'panel',style:'padding-bottom: 5px;',id:'receivingList_detailArea',title:'',border:1,items:[{xtype:'form',id:'form_receivingList',height:160,title:'',border:0,dockedItems:[{xtype:'panel',maintainFlex:false,bodyPadding:10,width:385,title:'',dock:'left',flex:1,border:false,items:[{xtype:'hidden',name:'form_type_receivingList',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'hidden',name:'po_id'},{xtype:'textfield',name:'receive_number',fieldLabel:'Receive No',labelWidth:90,anchor:'60%',readOnly:true,value:'auto',allowBlank:false},{xtype:'datefield',name:'receive_date',fieldLabel:'Date',labelWidth:90,format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false},{xtype:'combobox',name:'po_number',fieldLabel:'PO.NO',emptyText:'(Auto Complete)',labelWidth:90,width:350,allowBlank:false,store:store_purchaseOrderAutocomplete_add_receivingList,displayField:'po_number_rl_status',valueField:'id',hideTrigger:true,queryMode:'local',anyMatch:true,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_receivingList').getForm();form.findField('po_id').setValue(records[0].data.id);form.findField('supplier_id').setValue(records[0].data.supplier_id);form.findField('supplier_name').setValue(records[0].data.supplier_name);form.findField('receive_memo').setValue(records[0].data.po_memo);form.findField('receive_project').setValue(records[0].data.po_project);form.findField('receive_ship_to').setValue(records[0].data.po_ship_to);var myMask=new Ext.LoadMask(Ext.getCmp('receivingList_detailArea'),{msg:"Loading..."});myMask.show();me.store_receiveDetailTemp.proxy.extraParams.po_id=records[0].data.id;me.store_receiveDetailTemp.load({callback:function(){var d=Ext.getCmp('grid_receiveDetail').store.getRange(0);var dataTemp=[];var no=1;for(var i=0;i<d.length;i++)
{var dtDetReceive={receive_id:d[i].data.receive_id,item_id:d[i].data.item_id,supplier_item_id:d[i].data.supplier_item_id,item_id_real:d[i].data.item_id_real,item_code:d[i].data.item_code,item_code_name:d[i].data.item_code_name,item_name:d[i].data.item_name,unit_id:d[i].data.unit_id,unit_name:d[i].data.unit_name,receive_det_qty:d[i].data.receive_det_qty,receive_det_qty_before:d[i].data.receive_det_qty_before,receive_det_purchase:d[i].data.receive_det_purchase,receive_det_purchase_show:d[i].data.receive_det_purchase_show,po_detail_id:d[i].data.po_detail_id,po_detail_qty:d[i].data.po_detail_qty,po_receive_qty:d[i].data.po_receive_qty,po_detail_qty_sisa:d[i].data.po_detail_qty_sisa,receive_det_date:d[i].data.receive_det_date,use_stok_kode_unik:d[i].data.use_stok_kode_unik,data_stok_kode_unik:d[i].data.data_stok_kode_unik,id:d[i].data.id}
no++;dataTemp.push(dtDetReceive);}
me.storeReceivingListDetail_dataTemp=dataTemp;Ext.getCmp('grid_receiveDetail').store.loadData(me.storeReceivingListDetail_dataTemp);myMask.hide();}});},}},{xtype:'hidden',name:'storehouse_id'},{xtype:'combobox',name:'storehouse_name',fieldLabel:'Warehouse',emptyText:'Pilih Gudang',labelWidth:90,width:350,store:store_ComboboxMasterStoreHouse_receivingList,displayField:'storehouse_name',valueField:'id',queryMode:'local',allowBlank:false,listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_receivingList').getForm();form2.findField('storehouse_id').setValue(records[0].data.id);form2.findField('storehouse_name').setValue(records[0].data.storehouse_name);}}},{xtype:'displayfield',name:'info_receiving_list',value:'*Stok ter-update jika status Done/Selesai'}]},{xtype:'panel',bodyPadding:10,width:390,title:'',dock:'left',flex:1,border:false,items:[{xtype:'hidden',name:'total_qty'},{xtype:'hidden',name:'total_price'},{xtype:'hidden',name:'supplier_id'},{xtype:'textfield',name:'supplier_name',fieldLabel:'Supplier',anchor:'100%',labelWidth:90,width:370,allowBlank:false},{xtype:'textfield',name:'receive_project',fieldLabel:'Project',anchor:'100%',labelWidth:90,hidden:true,width:370,allowBlank:true},{xtype:'textfield',name:'no_surat_jalan',fieldLabel:'Surat Jalan',anchor:'100%',labelWidth:90,width:370,allowBlank:true},{xtype:'textfield',name:'receive_ship_to',fieldLabel:'Ship To',anchor:'100%',labelWidth:90,hidden:true,width:370,allowBlank:true},{xtype:'textarea',name:'receive_memo',fieldLabel:'Notes/Memo',labelSeparator:':',labelWidth:90,width:370,height:50,},{xtype:'radiogroup',fieldLabel:'Status',labelWidth:90,width:370,items:[{xtype:'radiofield',boxLabel:'Progress',name:'receive_status',inputValue:'progress',id:'rd_progress'},{xtype:'radiofield',boxLabel:'Done/Selesai',name:'receive_status',inputValue:'done',id:'rd_done'}]}]}]}]},{xtype:'gridpanel',height:280,store:me.store_receiveDetailTemp,id:'grid_receiveDetail',scroll:true,border:1,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'Detail ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'receive_id',text:'Receiving ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'receive_number',text:'Receiving NO',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'po_detail_id',text:'Detail PO ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'supplier_item_id',text:'Supply ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_id',text:'Supply ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_id_real',text:'Item ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'use_stok_kode_unik',text:'use KU',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'data_stok_kode_unik',text:'data KU',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'unit_id',text:'Unit ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'receive_det_qty_before',text:'QTY Before Edit',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'receive_det_purchase',text:'Detail Price',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_code_name',text:'item_code_name',hidden:true,hideable:false},{xtype:'gridcolumn',width:110,dataIndex:'item_code',text:'Kode',sortable:false},{xtype:'gridcolumn',width:170,dataIndex:'item_name',text:'Nama Barang',sortable:false},{xtype:'gridcolumn',width:120,dataIndex:'receive_det_purchase_show',text:'Hrg.Beli',align:'right',sortable:false},{xtype:'gridcolumn',width:100,dataIndex:'unit_name',text:'Unit',sortable:false},{xtype:'gridcolumn',width:70,dataIndex:'po_detail_qty',text:'Total<br/>Pesan',align:'center',sortable:false},{xtype:'gridcolumn',width:80,dataIndex:'po_receive_qty',text:'Total<br/>Terima',align:'center',sortable:false},{xtype:'gridcolumn',width:80,dataIndex:'po_detail_qty_sisa',text:'Sisa<br/>Barang',align:'center',sortable:false},{xtype:'gridcolumn',width:80,dataIndex:'receive_det_qty',text:'Qty<br/>Terima',align:'center',sortable:false},{xtype:'gridcolumn',width:90,dataIndex:'receive_det_date',text:'Tgl<br/>Terima',align:'center',sortable:false}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){if(!me.edit_data){}else{if(me.edit_data.receive_status=='done'){ExtApp.Msg.warning('Cannot Edit, Change Status Receive to Progress and Save!');return true;}}
var form=Ext.getCmp('form_receivingList').getForm();var getSelection=Ext.getCmp('grid_receiveDetail').getSelectionModel().selected;if(getSelection.length>0){me.formType_Detail='edit';me.edit_data=rec.data;if(parseFloat(me.edit_data.po_detail_qty_sisa)==0){ExtApp.Msg.warning('Cannot Receive, All Order been received!');}else{if(me.edit_data.use_stok_kode_unik==1){me.createWindow(me,'edit_receiveDetailKodeUnik');}else{me.createWindow(me,'edit_receiveDetail');}}}}},dockedItems:[{xtype:'toolbar',dock:'top',items:['->',{text:'Refresh',itemId:'refreshButton_receiveDetail',tooltip:'Refresh Receiving List Detail',iconCls:'btn-refresh',handler:function(){var form=Ext.getCmp('form_receivingList').getForm();if(form.findField('form_type_receivingList').getValue()=='add'){Ext.getCmp('grid_receiveDetail').store.loadData(me.storeReceivingListDetail_dataTemp);}else{Ext.getCmp('grid_receiveDetail').store.load();}}}]}]}]}],buttons:[{text:'Print',formBind:true,id:'btnPrint_receivingList',iconCls:'btn-print',handler:function(){me.print_receivingList();}},'->',{text:'Save',formBind:true,id:'btnSave_receivingList',iconCls:'btn-save',handler:function(){me.save_receivingList();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_receivingList');}}],listeners:{show:function(){var form=Ext.getCmp('form_receivingList').getForm();var receive_id=-1;if(form.findField('form_type_receivingList').getValue()=='add'){form.reset();var myMask=new Ext.LoadMask(Ext.getCmp('receivingList_detailArea'),{msg:"Loading..."});myMask.show();form.findField('receive_number').setDisabled(true);form.findField('receive_number').setReadOnly(true);form.findField('supplier_name').setReadOnly(true);form.findField('receive_date').format='d-m-Y';form.findField('receive_date').setValue(new Date());Ext.getCmp('rd_progress').setValue(true);Ext.getCmp('rd_done').setValue(false);Ext.getCmp('btnPrint_receivingList').setDisabled(true);me.storeReceivingListDetail_dataTemp=[];me.store_receiveDetailTemp.proxy.extraParams.receive_id=receive_id;me.store_receiveDetailTemp.loadData(me.storeReceivingListDetail_dataTemp);store_purchaseOrderAutocomplete_add_receivingList.load({callback:function(){myMask.hide();}});}else{form.setValues(me.edit_data);var receive_id=me.edit_data.id;form.findField('receive_number').setReadOnly(true);form.findField('po_number').setReadOnly(true);form.findField('supplier_name').setReadOnly(true);if(me.edit_data.receive_status=='done'){Ext.getCmp('rd_progress').setValue(false);Ext.getCmp('rd_done').setValue(true);}else{Ext.getCmp('rd_progress').setValue(true);Ext.getCmp('rd_done').setValue(false);}
Ext.getCmp('btnPrint_receivingList').setDisabled(false);var myMask=new Ext.LoadMask(Ext.getCmp('receivingList_detailArea'),{msg:"Loading..."});myMask.show();me.store_receiveDetailTemp.proxy.extraParams.receive_id=receive_id;me.store_receiveDetailTemp.load({callback:function(){myMask.hide();}});}
if(opt_receiving_select_warehouse==1){store_ComboboxMasterStoreHouse_receivingList.load({callback:function(){if(form.findField('form_type_receivingList').getValue()=='edit'){form.findField('storehouse_id').setValue(me.edit_data.storehouse_id);}}});form.findField('storehouse_name').allowBlank=false;form.findField('storehouse_name').show();}else{form.findField('storehouse_name').allowBlank=true;form.findField('storehouse_name').hide();}}}});},edit_receiveDetail:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add Detail ';if(me.formType_Detail=='edit'){Titletext='Update Detail ';}
var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');return desktop.createWindow({id:me.id+'_edit_receiveDetail',title:Titletext,width:420,height:280,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_receiveDetail',border:0,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'hidden',name:'id'},{xtype:'hidden',name:'receive_detail_status'},{xtype:'hidden',name:'form_type_receiveDetail',value:me.formType_Detail},{xtype:'hidden',name:'receive_id'},{xtype:'hidden',name:'receive_number'},{xtype:'hidden',name:'po_detail_id'},{xtype:'hidden',name:'unit_id'},{xtype:'hidden',name:'supplier_item_id'},{xtype:'hidden',name:'item_id'},{xtype:'hidden',name:'item_id_real'},{xtype:'hidden',name:'receive_det_purchase'},{xtype:'hidden',name:'receive_det_qty_before'},{xtype:'hidden',name:'po_detail_qty'},{xtype:'hidden',name:'po_receive_qty'},{xtype:'hidden',name:'item_code'},{xtype:'hidden',name:'item_code_name'},{xtype:'hidden',name:'use_stok_kode_unik'},{xtype:'hidden',name:'data_stok_kode_unik'},{xtype:'displayfield',name:'item_name',fieldLabel:'Nama Brg',labelSeparator:':',labelWidth:100,anchor:'100%',allowBlank:false},{xtype:'displayfield',name:'unit_name',fieldLabel:'Unit',labelSeparator:':',labelWidth:100,anchor:'100%',allowBlank:false},{xtype:'displayfield',name:'po_detail_qty_sisa',fieldLabel:'Sisa Qty',labelSeparator:':',labelWidth:100,anchor:'100%',allowBlank:false},{xtype:'numberfield',name:'receive_det_qty',fieldLabel:'Qty Terima',width:200,labelWidth:100,minValue:0,allowDecimals:true,allowBlank:false,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false},{xtype:'datefield',name:'receive_det_date',fieldLabel:'Tgl Terima',labelWidth:100,format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false}]}],buttons:[{text:'Save',formBind:true,id:'btnSave_receiveDetail',iconCls:'btn-save',handler:function(){me.save_receiveDetail();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_edit_receiveDetail');}}],listeners:{show:function(){var form2=Ext.getCmp('form_receiveDetail').getForm();form2.setValues(me.edit_data);}}});},edit_receiveDetailKodeUnik:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add Detail ';if(me.formType_Detail=='edit'){Titletext='Update Detail ';}
var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');return desktop.createWindow({id:me.id+'_edit_receiveDetailKodeUnik',title:Titletext,width:700,height:370,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_receiveDetailKodeUnik',border:0,bodyPadding:0,margin:'0 0 0 0',layout:{type:'border'},items:[{xtype:'panel',flex:0.8,region:'center',layout:{type:'auto'},border:0,bodyPadding:10,margin:'0 5 0 0',defaults:{margin:'5 0 0 0',width:285},items:[{xtype:'hidden',name:'id'},{xtype:'hidden',name:'receive_detail_status'},{xtype:'hidden',name:'form_type_receiveDetail',value:me.formType_Detail},{xtype:'hidden',name:'receive_id'},{xtype:'hidden',name:'receive_number'},{xtype:'hidden',name:'po_detail_id'},{xtype:'hidden',name:'unit_id'},{xtype:'hidden',name:'supplier_item_id'},{xtype:'hidden',name:'item_id'},{xtype:'hidden',name:'item_id_real'},{xtype:'hidden',name:'receive_det_purchase'},{xtype:'hidden',name:'receive_det_qty_before'},{xtype:'hidden',name:'po_detail_qty'},{xtype:'hidden',name:'po_receive_qty'},{xtype:'hidden',name:'item_code'},{xtype:'hidden',name:'item_code_name'},{xtype:'displayfield',name:'item_name',fieldLabel:'Nama Brg',labelSeparator:':',labelWidth:100,anchor:'100%',allowBlank:false},{xtype:'displayfield',name:'unit_name',fieldLabel:'Unit',labelSeparator:':',labelWidth:100,anchor:'100%',allowBlank:false},{xtype:'displayfield',name:'po_detail_qty_sisa',fieldLabel:'Sisa Qty',labelSeparator:':',labelWidth:100,anchor:'100%',allowBlank:false},{xtype:'numberfield',name:'receive_det_qty',fieldLabel:'Qty Terima',width:200,labelWidth:100,minValue:0,allowDecimals:true,allowBlank:false,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false},{xtype:'datefield',name:'receive_det_date',fieldLabel:'Tgl Terima',labelWidth:100,format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false}]},{xtype:'panel',flex:1,region:'east',layout:{type:'auto'},border:0,bodyPadding:10,items:[{xtype:'hidden',name:'use_stok_kode_unik'},{xtype:'displayfield',fieldLabel:'',value:'<b>Stok Kode Unik (SN/IMEI)</b>',anchor:'100%',},{xtype:'textarea',name:'data_stok_kode_unik',fieldLabel:'',labelWidth:0,width:360,height:250,}]}]}],buttons:[{text:'Save',formBind:true,id:'btnSave_receiveDetailKodeUnik',iconCls:'btn-save',handler:function(){me.save_receiveDetail(1);}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_edit_receiveDetailKodeUnik');}}],listeners:{show:function(){var form2=Ext.getCmp('form_receiveDetailKodeUnik').getForm();form2.setValues(me.edit_data);}}});}});