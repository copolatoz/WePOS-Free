/**
 * Filename: master_pos.discountPlannerFree.js
 * Generated 2020-08-16 at 06:48:56 PM
 */
Ext.define('ExtApp.modules.master_pos.model.model_discountPlanner',{extend:'Ext.data.Model',alias:'model_discountPlanner',fields:[{name:'id',type:'int'},{name:'discount_type',type:'string'},{name:'discount_type_text',type:'string'},{name:'discount_name',type:'string'},{name:'discount_percentage',type:'string'},{name:'discount_price',type:'string'},{name:'discount_max_price',type:'string'},{name:'min_total_billing',type:'int'},{name:'discount_date_type',type:'string'},{name:'discount_product',type:'int'},{name:'discount_desc',type:'string'},{name:'date_start',type:'string'},{name:'date_end',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'is_discount_billing',type:'int'},{name:'is_discount_billing_text',type:'string'},{name:'is_promo',type:'int'},{name:'is_promo_text',type:'string'},{name:'is_buy_get',type:'int'},{name:'is_buy_get_text',type:'string'},{name:'discount_allow_day',type:'string'},{name:'discount_allow_day_text',type:'string'},{name:'use_discount_time',type:'int'},{name:'use_discount_time_text',type:'string'},{name:'discount_time_start',type:'string'},{name:'discount_time_end',type:'string'},{name:'is_sistem_tawar',type:'int'},{name:'diskon_sebelum_pajak_service',type:'int'},],proxy:{type:'ajax',url:appUrl+'master_pos/discountPlanner/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_discountPlannerProduct',{extend:'Ext.data.Model',alias:'model_discountPlannerProduct',fields:[{name:'id',type:'int'},{name:'discount_id',type:'string'},{name:'product_id',type:'string'},{name:'product_name',type:'string'},{name:'category_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/discountPlannerProduct/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_discountPlannerProduct_masterProduct',{extend:'Ext.data.Model',alias:'model_discountPlannerProduct_masterProduct',fields:[{name:'id',type:'int'},{name:'product_id',type:'string'},{name:'product_name',type:'string'},{name:'category_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/discountPlannerProduct/gridDataProduct',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_voucherList',{extend:'Ext.data.Model',alias:'model_voucherList',fields:[{name:'id',type:'int'},{name:'voucher_no',type:'string'},{name:'voucher_status',type:'int'},{name:'voucher_status_text',type:'string'},{name:'date_used',type:'string'},{name:'ref_billing_no',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/voucherList/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_buygetList',{extend:'Ext.data.Model',alias:'model_buygetList',fields:[{name:'id',type:'int'},{name:'buyget_tipe',type:'string'},{name:'buy_item',type:'string'},{name:'buy_item_name',type:'string'},{name:'buy_qty',type:'string'},{name:'get_item',type:'string'},{name:'get_item_name',type:'string'},{name:'get_qty',type:'string'},{name:'get_percentage',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/buygetList/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.store.store_discountPlanner',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_discountPlanner',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_discountType',{extend:'Ext.data.Store',fields:['val','name'],data:[{"val":"0","name":"Per-Item Order"},{"val":"1","name":"Per-Billing"},{"val":"2","name":"Buy and Get"}],autoLoad:false});Ext.define('ExtApp.modules.master_pos.store.store_discountDateType',{extend:'Ext.data.Store',fields:['val','name'],data:[{"val":"limited_date","name":"Limited Date"},{"val":"unlimited_date","name":"Unlimited Date"}],autoLoad:false});Ext.define('ExtApp.modules.master_pos.store.store_discountAllowDay',{extend:'Ext.data.Store',fields:['val','name'],data:[{"val":"0","name":"Every Day"},{"val":"1","name":"Monday"},{"val":"2","name":"Tuesday"},{"val":"3","name":"Wednesday"},{"val":"4","name":"Thursday"},{"val":"5","name":"Friday"},{"val":"6","name":"Saturday"},{"val":"7","name":"Sunday"},{"val":"8","name":"Weekday"},{"val":"9","name":"Weekend"}],autoLoad:false});Ext.define('ExtApp.modules.master_pos.store.store_discountPlannerProduct',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_discountPlannerProduct',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_discountPlannerProduct_masterProduct',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_discountPlannerProduct_masterProduct',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_voucherList',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_voucherList',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_buygetTipe',{extend:'Ext.data.Store',fields:['val','name'],data:[{"val":"","name":"Select"},{"val":"item","name":"Item"},{"val":"percentage","name":"Percentage"}],autoLoad:false});Ext.define('ExtApp.modules.master_pos.store.store_buygetList',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_buygetList',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.master_pos.view.discountPlannerFree",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_discountPlanner_discountPlanner=theApp.getStore('store_discountPlanner_discountPlanner',false);if(store_discountPlanner_discountPlanner==false){store_discountPlanner_discountPlanner=theApp.copyStore('master_pos','store_discountPlanner','store_discountPlanner_discountPlanner');}
store_discountPlanner_discountPlanner.proxy.extraParams.is_discBilling=-1;store_discountPlanner_discountPlanner.proxy.extraParams.limit=25;store_discountPlanner_discountPlanner.proxy.extraParams.show_all_text=0;store_discountPlanner_discountPlanner.proxy.extraParams.show_choose_text=0;store_discountPlanner_discountPlanner.proxy.extraParams.is_dropdown=0;store_discountPlanner_discountPlanner.proxy.extraParams.keywords='';var helperGrid=theApp.getHelper('Grid');var selModel_discountPlanner=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_discountPlanner').down('#deleteButton_discountPlanner').setDisabled(selections.length==0);}}});me.pagingtb_discountPlanner=helperGrid.paging({ds:store_discountPlanner_discountPlanner,title:'Discount Planner'});return desktop.createWindow({id:me.id,title:'Discount Planner',width:900,height:480,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:0,layout:{type:'fit'},items:[{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_discountPlanner_discountPlanner,id:'grid_discountPlanner',scroll:true,selModel:selModel_discountPlanner,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'#ID',width:50},{xtype:'gridcolumn',dataIndex:'discount_name',text:'Discount Name',width:200},{xtype:'gridcolumn',dataIndex:'discount_type_text',text:'Disc.Type',width:130},{xtype:'gridcolumn',dataIndex:'is_promo_text',text:'Auto Promo',width:100,align:'center'},{xtype:'gridcolumn',dataIndex:'is_buy_get_text',text:'Buy &amp; Get',width:100,align:'center'},{xtype:'gridcolumn',dataIndex:'discount_percentage',text:'%',width:70,align:'center'},{xtype:'gridcolumn',dataIndex:'discount_price',text:'Price',width:80,align:'center'},{xtype:'gridcolumn',dataIndex:'discount_max_price',text:'Max Disc.Price',width:120,align:'center'},{xtype:'gridcolumn',dataIndex:'discount_date_type',text:'Date Type',width:120,align:'center'},{xtype:'gridcolumn',dataIndex:'min_total_billing',text:'Min. Total Bill',width:120},{xtype:'gridcolumn',dataIndex:'date_start',text:'Date Start',width:100},{xtype:'gridcolumn',dataIndex:'date_end',text:'Date End',width:100},{xtype:'gridcolumn',dataIndex:'discount_desc',text:'Description',width:200},{xtype:'gridcolumn',dataIndex:'is_active_text',text:'Status Active',width:100}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_discountPlanner').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_discountPlanner');}}},bbar:me.pagingtb_discountPlanner,dockedItems:[{xtype:'toolbar',dock:'top',items:[{xtype:'textfield',name:'keywords',id:'keywords_discountPlanner',width:200,labelSeparator:'',emptyText:'Keywords: Discount Name',anchor:'100%',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_discountPlanner();}}}},{xtype:'button',text:'Search',itemId:'btnFilterSearch_discountPlanner',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_discountPlanner();}},{xtype:'button',text:'Reset',itemId:'btnResetFilterSearch_discountPlanner',tooltip:'Reset',iconCls:'btn-reset',handler:function(){me.search_discountPlanner(true);}},'->',{text:'Add New Discount',itemId:'addButton_discountPlanner',tooltip:'Add New Discount Planner',iconCls:'btn-add',handler:function(){me.formType='add';me.createWindow(me,'add_discountPlanner');}},'-',{text:'Delete',itemId:'deleteButton_discountPlanner',tooltip:'Delete Discount Planner',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_discountPlanner').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;me.deleteConfirm_discountPlanner();}else{ExtApp.Msg.info('Please Select Discount Planner!');}}},]}]}],listeners:{show:function(){me.search_discountPlanner();}}});},add_discountPlanner:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add New Discount';if(me.formType=='edit'){Titletext='Update Discount';}
var store_discountType=theApp.getStore('master_pos.store_discountType',false);var store_discountDateType=theApp.getStore('master_pos.store_discountDateType',false);var store_discountAllowDay=theApp.getStore('master_pos.store_discountAllowDay',false);var phpJs=theApp.getHelper('phpJs');var helperGrid=theApp.getHelper('Grid');var selModel_discountPlannerProduct=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_discountPlannerProduct').down('#deleteButton_discountPlannerProduct').setDisabled(selections.length==0);}}});var selModel_discountPlannerProduct_masterProduct=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_discountPlannerProduct_masterProduct').down('#addButton_discountPlannerProduct_masterProduct').setDisabled(selections.length==0);}}});var store_discountPlannerProduct_grid=theApp.getStore('store_discountPlannerProduct_grid',false);if(store_discountPlannerProduct_grid==false){store_discountPlannerProduct_grid=theApp.copyStore('master_pos','store_discountPlannerProduct','store_discountPlannerProduct_grid');}
store_discountPlannerProduct_grid.proxy.extraParams.limit=999999;store_discountPlannerProduct_grid.proxy.extraParams.is_dropdown=0;store_discountPlannerProduct_grid.proxy.extraParams.discount_id=0;var store_discountPlannerProduct_masterProduct_grid=theApp.getStore('store_discountPlannerProduct_masterProduct_grid',false);if(store_discountPlannerProduct_masterProduct_grid==false){store_discountPlannerProduct_masterProduct_grid=theApp.copyStore('master_pos','store_discountPlannerProduct_masterProduct','store_discountPlannerProduct_masterProduct_grid');}
store_discountPlannerProduct_masterProduct_grid.proxy.extraParams.limit=999999;store_discountPlannerProduct_masterProduct_grid.proxy.extraParams.discount_id=0;var store_voucherList_discountPlanner=theApp.getStore('store_voucherList_discountPlanner',false);if(store_voucherList_discountPlanner==false){store_voucherList_discountPlanner=theApp.copyStore('master_pos','store_voucherList','store_voucherList_discountPlanner');}
store_voucherList_discountPlanner.proxy.extraParams.limit=999999;store_voucherList_discountPlanner.proxy.extraParams.is_dropdown=0;store_voucherList_discountPlanner.proxy.extraParams.discount_id=0;var selModel_voucherList_discountPlanner=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_voucherList_discountPlanner').down('#addButton_voucherList_discountPlanner').setDisabled(selections.length==0);Ext.getCmp('grid_voucherList_discountPlanner').down('#deleteButton_voucherList_discountPlanner').setDisabled(selections.length==0);}}});var store_buygetList_discountPlanner=theApp.getStore('store_buygetList_discountPlanner',false);if(store_buygetList_discountPlanner==false){store_buygetList_discountPlanner=theApp.copyStore('master_pos','store_buygetList','store_buygetList_discountPlanner');}
store_buygetList_discountPlanner.proxy.extraParams.limit=999999;store_buygetList_discountPlanner.proxy.extraParams.is_dropdown=0;store_buygetList_discountPlanner.proxy.extraParams.discount_id=0;var selModel_buygetList_discountPlanner=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_buygetList_discountPlanner').down('#addButton_buygetList_discountPlanner').setDisabled(selections.length==0);Ext.getCmp('grid_buygetList_discountPlanner').down('#deleteButton_buygetList_discountPlanner').setDisabled(selections.length==0);}}});Ext.apply(Ext.form.field.VTypes,{daterange:function(val,field){var date=field.parseDate(val);if(!date){return false;}
if(field.startDateField&&(!this.dateRangeMax||(date.getTime()!=this.dateRangeMax.getTime()))){var start=field.up('form').down('#'+field.startDateField);start.setMaxValue(date);start.validate();this.dateRangeMax=date;}
else if(field.endDateField&&(!this.dateRangeMin||(date.getTime()!=this.dateRangeMin.getTime()))){var end=field.up('form').down('#'+field.endDateField);end.setMinValue(date);end.validate();this.dateRangeMin=date;}
return true;},daterangeText:'Start date must be less than end date'});return desktop.createWindow({id:me.id+'_add_discountPlanner',title:Titletext,width:800,height:470,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:{xtype:'tabpanel',minHeight:340,activeTab:0,border:false,defaults:{bodyPadding:'10 10 10 10',layout:'fit'},items:[{title:'Discount Info',layout:'fit',items:[{xtype:'form',id:'form_discountPlanner',border:0,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'panel',layout:{type:'column'},fieldLabel:'',border:false,items:[{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:350,border:false,margin:'0 40 0 0',items:[{xtype:'hidden',name:'form_type_discountPlanner',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'textfield',name:'discount_name',fieldLabel:'Discount Name',width:350,allowBlank:false},{xtype:'combobox',name:'discount_type',id:'discount_type_discountPlanner',fieldLabel:'Disc.Type',store:store_discountType,labelSeparator:':',width:350,displayField:'name',queryMode:'local',valueField:'val',typeAhead:true,minChars:1,forceSelection:true,allowBlank:false,listeners:{select:function(combo,records,eOpts){}}},{xtype:'checkbox',name:'is_promo',fieldLabel:'Auto Disc / Promo ?',inputValue:'1',labelWidth:130,width:350,readOnly:true,labelStyle:'color:blue;'},{xtype:'checkbox',name:'is_buy_get',fieldLabel:'Buy &amp; Get Promo ?',inputValue:'1',labelWidth:130,width:350,readOnly:true,labelStyle:'color:blue;'},{xtype:'numberfield',name:'discount_percentage',fieldLabel:'Disc.%',width:170,minValue:0,hideTrigger:true,allowDecimals:true,hideTrigger:true},{xtype:'numberfield',name:'discount_price',fieldLabel:'Disc.Price',width:220,minValue:0,hideTrigger:true,allowDecimals:true,hideTrigger:true},{xtype:'textfield',name:'discount_max_price',fieldLabel:'Max Disc.Price',width:220},{xtype:'textfield',name:'min_total_billing',fieldLabel:'Min.Total Bill',width:220},{xtype:'textfield',name:'discount_desc',fieldLabel:'Description',width:350},{xtype:'checkbox',name:'is_active',fieldLabel:'Status Active',inputValue:'1'},{xtype:'checkbox',name:'is_sistem_tawar',fieldLabel:'Bayar Bebas?',inputValue:'1',readOnly:true,labelStyle:'color:blue;'}]},{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:350,border:false,margin:'0 0 0 0',items:[{xtype:'combobox',name:'discount_date_type',id:'discount_date_type_discountPlanner',fieldLabel:'Date.Type',store:store_discountDateType,labelSeparator:':',width:350,displayField:'name',queryMode:'local',valueField:'val',typeAhead:true,minChars:1,forceSelection:true,allowBlank:false,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_discountPlanner').getForm();if(records[0].data.val=='unlimited_date'){form.findField('date_start').setDisabled(true);form.findField('date_end').setDisabled(true);}else{form.findField('date_start').setDisabled(false);form.findField('date_end').setDisabled(false);}}}},{xtype:'datefield',format:'d-m-Y',submitFormat:'Y-m-d',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',fieldLabel:'Start Date',name:'date_start',itemId:'date_start_discountPlanner',vtype:'daterange',endDateField:'date_end_discountPlanner'},{xtype:'datefield',format:'d-m-Y',submitFormat:'Y-m-d',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',fieldLabel:'End Date',name:'date_end',itemId:'date_end_discountPlanner',vtype:'daterange',startDateField:'date_start_discountPlanner'},{xtype:'combobox',name:'discount_allow_day',id:'discount_allow_day_discountPlanner',fieldLabel:'Allow Day',store:store_discountAllowDay,labelSeparator:':',width:350,displayField:'name',queryMode:'local',valueField:'val',typeAhead:true,minChars:1,forceSelection:true,readOnly:true,labelStyle:'color:blue;',listeners:{select:function(combo,records,eOpts){}}},{xtype:'checkbox',name:'use_discount_time',fieldLabel:'Use Discount Time',inputValue:'1',labelWidth:130,readOnly:true,labelStyle:'color:blue;'},{xtype:'timefield',name:'discount_time_start',fieldLabel:'Time Start',minValue:'0:00 AM',maxValue:'24:00 PM',increment:10,width:200,readOnly:true,labelStyle:'color:blue;'},{xtype:'timefield',name:'discount_time_end',fieldLabel:'Time End',minValue:'0:00 AM',maxValue:'24:00 PM',increment:10,width:200,readOnly:true,labelStyle:'color:blue;'}]}]}]}]},{title:'Product List',id:'discount_product_list_discountPlanner',bodyPadding:'0 0 0 0',layout:'fit',items:[{xtype:'panel',border:0,layout:{type:'border'},items:[{xtype:'gridpanel',margins:'0 10 0 0',border:0,region:'west',height:250,flex:1,store:store_discountPlannerProduct_masterProduct_grid,id:'grid_discountPlannerProduct_masterProduct',scroll:true,selModel:selModel_discountPlannerProduct_masterProduct,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'product_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'product_name',text:'Product/Menu Name',width:180},{xtype:'gridcolumn',dataIndex:'category_name',text:'Category Name',width:160}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){}},dockedItems:[{xtype:'toolbar',dock:'top',items:['->',{text:'Add >> ',itemId:'addButton_discountPlannerProduct_masterProduct',tooltip:'Select Product',iconCls:'btn-add',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_discountPlannerProduct_masterProduct').getSelectionModel().selected;if(getSelection.length>0){me.add_data_listSelectedProduct=getSelection.items[0].data;me.addAction_discountPlannerProduct();}else{ExtApp.Msg.info('Please Select Product!');}}},'-',{text:'',itemId:'refreshButton_discountPlannerProduct_masterProduct',tooltip:'Refresh Product',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_discountPlannerProduct_masterProduct').store.load();}}]}]},{xtype:'gridpanel',margins:'0 0 0 0',border:0,region:'center',height:250,flex:1,store:store_discountPlannerProduct_grid,id:'grid_discountPlannerProduct',scroll:true,selModel:selModel_discountPlannerProduct,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'discount_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'product_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'product_name',text:'Product/Menu Name',width:180},{xtype:'gridcolumn',dataIndex:'category_name',text:'Category Name',width:160}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){}},dockedItems:[{xtype:'toolbar',dock:'top',items:['->',{text:'Delete',itemId:'deleteButton_discountPlannerProduct',tooltip:'Delete Product',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_discountPlannerProduct').getSelectionModel().selected;if(getSelection.length>0){me.delete_data_listProduct=getSelection.items[0].data;me.deleteConfirm_discountPlannerProduct();}else{ExtApp.Msg.info('Please Select Product!');}}},'-',{text:'',itemId:'refreshButton_discountPlannerProduct',tooltip:'Refresh List Selected Product',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_discountPlannerProduct').store.load();}}]}]}]}]},{title:'Buy & Get',id:'buy_and_get_list_discountPlanner',bodyPadding:'0 0 0 0',layout:'fit',items:[{xtype:'gridpanel',border:0,id:'grid_buygetList_discountPlanner',store:store_buygetList_discountPlanner,scroll:true,selModel:selModel_buygetList_discountPlanner,columns:[{xtype:'gridcolumn',dataIndex:'id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'buyget_tipe',text:'Tipe',width:100},{xtype:'gridcolumn',dataIndex:'buy_item_name',text:'Buy Item',width:150},{xtype:'gridcolumn',dataIndex:'buy_qty',text:'Buy Qty',width:70,align:'center'},{xtype:'gridcolumn',dataIndex:'get_item_name',text:'Get Item',width:150},{xtype:'gridcolumn',dataIndex:'get_qty',text:'Get Qty',width:70,align:'center'},{xtype:'gridcolumn',dataIndex:'get_percentage',text:'Get %',width:70,align:'center'},{xtype:'gridcolumn',dataIndex:'is_active_text',text:'Active',width:80},],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){me.formType_buygetList='edit';me.edit_data_buygetList=rec.data;me.createWindow(me,'add_buygetList');}},dockedItems:[{xtype:'toolbar',dock:'top',items:['->',{text:'Add Rule',itemId:'addButton_buygetList_discountPlanner',tooltip:'Add Item Rule',iconCls:'btn-add',handler:function(){ExtApp.Msg.warning('Maaf, Voucher dan BuyGet Tersedia pada versi berbayar');}},'-',{text:'Delete',itemId:'deleteButton_buygetList_discountPlanner',tooltip:'Delete Item Rule',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_buygetList_discountPlanner').getSelectionModel().selected;if(getSelection.length>0){me.delete_data_buygetList=getSelection.items[0].data;me.deleteConfirm_buygetList_discountPlanner();}else{ExtApp.Msg.info('Please Select Item Rule!');}}},'-',{text:'',itemId:'refreshButton_buygetList_discountPlanner',tooltip:'Refresh Item Rule',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_buygetList_discountPlanner').store.load();}}]}]}]},{title:'Voucher List',id:'voucher_list_discountPlanner',bodyPadding:'0 0 0 0',layout:'fit',items:[{xtype:'gridpanel',border:0,id:'grid_voucherList_discountPlanner',store:store_voucherList_discountPlanner,scroll:true,selModel:selModel_voucherList_discountPlanner,columns:[{xtype:'gridcolumn',dataIndex:'id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'voucher_no',text:'Voucher No',width:300},{xtype:'gridcolumn',dataIndex:'voucher_status_text',text:'Status Used',width:100,align:'center'},{xtype:'gridcolumn',dataIndex:'date_used',text:'Date Used',width:100,align:'center'},{xtype:'gridcolumn',dataIndex:'ref_billing_no',text:'Ref.Billing No',width:150,align:'center'}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){me.formType_voucherList='edit';me.edit_data_voucherList=rec.data;me.createWindow(me,'add_voucherList');}},dockedItems:[{xtype:'toolbar',dock:'top',items:['->',{text:'Add',itemId:'addButton_voucherList_discountPlanner',tooltip:'Add Voucher',iconCls:'btn-add',handler:function(){ExtApp.Msg.warning('Maaf, Voucher dan BuyGet Tersedia pada versi berbayar');}},'-',{text:'Delete',itemId:'deleteButton_voucherList_discountPlanner',tooltip:'Delete Voucher',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_voucherList_discountPlanner').getSelectionModel().selected;if(getSelection.length>0){me.delete_data_voucherList=getSelection.items[0].data;me.deleteConfirm_voucherList_discountPlanner();}else{ExtApp.Msg.info('Please Select Voucher!');}}},'-',{text:'',itemId:'refreshButton_voucherList_discountPlanner',tooltip:'Refresh Voucher',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_voucherList_discountPlanner').store.load();}}]}]}],}]},buttons:[{xtype:'displayfield',value:'*setup untuk versi berbayar',fieldStyle:'font-weight:bold; color:blue;'},'->',{text:'Save',formBind:true,id:'btnSave_discountPlanner',iconCls:'btn-save',handler:function(){me.save_discountPlanner();}},'',{text:'Close',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_discountPlanner');}}],listeners:{show:function(){var form=Ext.getCmp('form_discountPlanner').getForm();store_discountPlannerProduct_grid.proxy.extraParams.discount_id=0;store_discountPlannerProduct_masterProduct_grid.proxy.extraParams.discount_id=0;Ext.getCmp('discount_product_list_discountPlanner').setDisabled(true);Ext.getCmp('buy_and_get_list_discountPlanner').setDisabled(true);Ext.getCmp('voucher_list_discountPlanner').setDisabled(false);if(me.formType=='edit'){Ext.getCmp('discount_product_list_discountPlanner').setDisabled(true);form.setValues(me.edit_data);if(me.edit_data.discount_date_type=='unlimited_date'){form.findField('date_start').setDisabled(true);form.findField('date_end').setDisabled(true);}else{form.findField('date_start').setDisabled(false);form.findField('date_end').setDisabled(false);}
if(me.edit_data.discount_type==0){Ext.getCmp('discount_product_list_discountPlanner').setDisabled(false);store_discountPlannerProduct_grid.proxy.extraParams.discount_id=me.edit_data.id;store_discountPlannerProduct_masterProduct_grid.proxy.extraParams.discount_id=me.edit_data.id;store_discountPlannerProduct_grid.load();store_discountPlannerProduct_masterProduct_grid.load();}
if(me.edit_data.is_buy_get==1||me.edit_data.discount_type==2){Ext.getCmp('discount_product_list_discountPlanner').setDisabled(true);Ext.getCmp('buy_and_get_list_discountPlanner').setDisabled(false);}
if(me.edit_data.is_sistem_tawar==1&&me.edit_data.discount_type==1){Ext.getCmp('buy_and_get_list_discountPlanner').setDisabled(true);Ext.getCmp('discount_product_list_discountPlanner').setDisabled(true);}
if(me.edit_data.is_promo==1){Ext.getCmp('buy_and_get_list_discountPlanner').setDisabled(true);Ext.getCmp('voucher_list_discountPlanner').setDisabled(true);}
store_voucherList_discountPlanner.proxy.extraParams.discount_id=me.edit_data.id;store_buygetList_discountPlanner.proxy.extraParams.discount_id=me.edit_data.id;}else{form.reset();form.findField('date_start').setValue(phpJs.date("d-m-Y"));form.findField('date_end').setValue(phpJs.date("d-m-Y"));form.findField('is_active').setValue(1);form.findField('is_discount_billing').setValue(0);}
store_discountType.load({callback:function(records,operation,success){if(me.formType=='edit'){Ext.getCmp('discount_type_discountPlanner').select(me.edit_data.discount_type);}}});store_discountDateType.load({callback:function(records,operation,success){if(me.formType=='edit'){Ext.getCmp('discount_date_type_discountPlanner').select(me.edit_data.discount_date_type);}}});store_discountAllowDay.load({callback:function(records,operation,success){if(me.formType=='edit'){Ext.getCmp('discount_allow_day_discountPlanner').select(me.edit_data.discount_allow_day);}}});store_voucherList_discountPlanner.load();store_buygetList_discountPlanner.load();}}});},add_voucherList:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add Voucher ';if(me.formType=='edit'){Titletext='Update Voucher ';}
return desktop.createWindow({id:me.id+'_add_voucherList_discountPlanner',title:Titletext,width:350,height:250,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_voucherList_discountPlanner',border:0,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'hidden',name:'form_type_voucherList',value:me.formType_voucherList},{xtype:'hidden',name:'discount_id'},{xtype:'hidden',name:'id'},{xtype:'textfield',name:'voucher_no',fieldLabel:'Voucher No',anchor:'100%',allowBlank:false},{xtype:'checkbox',name:'voucher_status',fieldLabel:'Is Used',inputValue:'1'},{xtype:'datefield',name:'date_used',format:'d-m-Y',submitFormat:'Y-m-d',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',fieldLabel:'Data Used',width:220},{xtype:'textfield',name:'ref_billing_no',fieldLabel:'Billing No',anchor:'100%'},{xtype:'checkbox',name:'is_active',fieldLabel:'Status Active',inputValue:'1'}]}],buttons:[{text:'Save',formBind:true,id:'btnSave_voucherList_discountPlanner',iconCls:'btn-save',handler:function(){me.save_voucherList_discountPlanner();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_voucherList_discountPlanner');}}],listeners:{show:function(){var form=Ext.getCmp('form_voucherList_discountPlanner').getForm();if(me.formType_voucherList=='edit'){form.setValues(me.edit_data_voucherList);}else{form.reset();form.findField('voucher_status').setValue(0);form.findField('date_used').setValue('');form.findField('is_active').setValue(1);}
form.findField('discount_id').setValue(me.edit_data.id);}}});},add_buygetList:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add Rule Buy &amp Get ';if(me.formType=='edit'){Titletext='Update Rule Buy &amp Get ';}
var store_buygetTipe=theApp.getStore('master_pos.store_buygetTipe',false);var store_masterProduct_buygetList=theApp.getStore('store_masterProduct_buygetList',false);if(store_masterProduct_buygetList==false){store_masterProduct_buygetList=theApp.copyStore('master_pos','store_discountPlannerProduct_masterProduct','store_masterProduct_buygetList');}
store_masterProduct_buygetList.proxy.extraParams.limit=999999;store_masterProduct_buygetList.proxy.extraParams.discount_id=0;return desktop.createWindow({id:me.id+'_add_buygetList_discountPlanner',title:Titletext,width:450,height:300,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_buygetList_discountPlanner',border:0,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'hidden',name:'form_type_buygetList',value:me.formType_buygetList},{xtype:'hidden',name:'discount_id'},{xtype:'hidden',name:'id'},{xtype:'combobox',name:'buyget_tipe',id:'buyget_tipe_buygetList',fieldLabel:'Tipe',store:store_buygetTipe,labelSeparator:':',anchor:'100%',displayField:'name',queryMode:'local',valueField:'val',typeAhead:true,minChars:1,forceSelection:true,allowBlank:false,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_buygetList_discountPlanner').getForm();if(records[0].data.val=='item'){form.findField('get_percentage').hide();form.findField('get_qty').show();}else{form.findField('get_percentage').show();form.findField('get_qty').hide();}}}},{xtype:'hidden',name:'buy_item'},{xtype:'combobox',name:'buy_item_name',id:'buy_item_buygetList_discountPlanner',fieldLabel:'Buy Product',anchor:'100%',store:store_masterProduct_buygetList,displayField:'product_name',valueField:'product_name',queryMode:'local',typeAhead:true,minChars:1,forceSelection:true,allowBlank:false,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_buygetList_discountPlanner').getForm();form.findField('buy_item').setValue(records[0].data.product_id);form.findField('buy_item_name').setValue(records[0].data.product_name);}}},{xtype:'textfield',name:'buy_qty',fieldLabel:'Buy Qty',width:180,allowBlank:false},{xtype:'hidden',name:'get_item'},{xtype:'combobox',name:'get_item_name',id:'get_item_buygetList_discountPlanner',fieldLabel:'Get Product',anchor:'100%',store:store_masterProduct_buygetList,displayField:'product_name',valueField:'product_name',queryMode:'local',typeAhead:true,minChars:1,forceSelection:true,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_buygetList_discountPlanner').getForm();form.findField('get_item').setValue(records[0].data.product_id);form.findField('get_item_name').setValue(records[0].data.product_name);}}},{xtype:'textfield',name:'get_qty',fieldLabel:'Get Qty',width:180},{xtype:'textfield',name:'get_percentage',fieldLabel:'Get %',width:180},{xtype:'checkbox',name:'is_active',fieldLabel:'Status Active',inputValue:'1'}]}],buttons:[{text:'Save',formBind:true,id:'btnSave_buygetList_discountPlanner',iconCls:'btn-save',handler:function(){me.save_buygetList_discountPlanner();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_buygetList_discountPlanner');}}],listeners:{show:function(){var form=Ext.getCmp('form_buygetList_discountPlanner').getForm();if(me.formType_buygetList=='edit'){form.setValues(me.edit_data_buygetList);if(me.edit_data_buygetList.buyget_tipe=='item'){form.findField('get_percentage').hide();form.findField('get_item_name').show();form.findField('get_qty').show();}else{form.findField('get_percentage').show();form.findField('get_item_name').hide();form.findField('get_qty').hide();}}else{form.reset();form.findField('buy_qty').setValue(1);form.findField('get_qty').setValue(1);form.findField('get_percentage').setValue(0);form.findField('is_active').setValue(1);form.findField('get_percentage').hide();form.findField('get_item_name').show();form.findField('get_qty').show();Ext.getCmp('buyget_tipe_buygetList').select('item');}
form.findField('discount_id').setValue(me.edit_data.id);store_masterProduct_buygetList.load({callback:function(records,operation,success){if(me.formType_buygetList=='edit'){Ext.getCmp('buy_item_buygetList_discountPlanner').select(me.edit_data_buygetList.buy_item_name);Ext.getCmp('get_item_buygetList_discountPlanner').select(me.edit_data_buygetList.get_item_name);}}});}}});}});