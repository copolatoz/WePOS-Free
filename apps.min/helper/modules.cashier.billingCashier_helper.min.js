/**
 * Filename: modules.cashier.billingCashier_helper.js
 * Generated 2018-07-19 at 09:26:05 AM
 */
Ext.define("ExtApp.helper.supervisor",{login:function(verifySpvData,scope){var me=scope;var h_this=this;me.verifySpvData=verifySpvData;if(!me.verifySpvData){alert('Load Supervisor Access Failed');return false;}
me.verifySpvData.verifyMode=1;var d=new Date();var n=d.getTime();me.verifySpvData.verifyRandNo=n;var WinIdSpv=me.verifySpvData.spvId+'_'+me.verifySpvData.verifyRandNo;me.WinSupervisor=Ext.create('Ext.window.Window',{id:'spvLogin_'+WinIdSpv,title:'Supervisor Access',width:300,iconCls:'icon-lock',animCollapse:false,constrainHeader:true,resizable:false,closable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_supervisor_'+WinIdSpv,width:300,border:false,bodyBorder:false,items:[{xtype:'panel',layout:{type:'anchor'},bodyPadding:10,border:false,items:[{xtype:'textfield',emptyText:'User ID',name:'username',anchor:'100%',inputType:'password',allowBlank:false,listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){h_this.verify_supervisor(me);}}}},{xtype:'textfield',name:'password',emptyText:'Password',anchor:'100%',inputType:'password',allowBlank:false,listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){h_this.verify_supervisor(me);}}}},{xtype:'textfield',name:'user_pin',emptyText:'PIN',anchor:'100%',inputType:'password',allowBlank:false,listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){h_this.verify_supervisor(me);}}}},{xtype:'displayfield',name:'displayAccess',value:'need Access Supervisor'}]}]}],buttons:[{text:'Verify Access',formBind:true,iconCls:'icon-lock-open',id:'btndoVerify_supervisor_'+WinIdSpv,margin:'0 10 0 0',handler:function(){h_this.verify_supervisor(me);}},{text:'Cancel',formBind:true,iconCls:'btn-cancel',id:'btnCancelVerify_supervisor_'+WinIdSpv,margin:'0 40 0 0',handler:function(){me.WinSupervisor.hide();delete me.WinSupervisor;}}],listeners:{show:function(){var form=Ext.getCmp('form_supervisor_'+WinIdSpv).getForm();form.reset();if(!me.verifySpvData.verifyMode){me.verifySpvData.verifyMode=0;}
form.findField('displayAccess').setValue('Access for '+me.verifySpvData.title);if(me.verifySpvData.verifyMode==1){form.findField('password').show();}else{form.findField('password').hide();}
if(opt_supervisor_pin_mode==1){form.findField('username').hide();form.findField('password').hide();form.findField('user_pin').show();form.findField('user_pin').focus();}else{form.findField('username').show();form.findField('password').show();form.findField('user_pin').hide();form.findField('username').focus();}}}});me.WinSupervisor.show();},verify_supervisor:function(scope){var me=scope;var verifySpvData=me.verifySpvData;var WinIdSpv=verifySpvData.spvId+'_'+verifySpvData.verifyRandNo;var form=Ext.getCmp('form_supervisor_'+WinIdSpv).getForm();var fUsername=form.findField('username').getValue();var fPassword=form.findField('password').getValue();var fUser_pin=form.findField('user_pin').getValue();if(verifySpvData.verifyMode==0){form.findField('password').allowBlank=true;}else{form.findField('password').allowBlank=false;}
if(opt_supervisor_pin_mode==1){form.findField('username').allowBlank=true;form.findField('password').allowBlank=true;form.findField('user_pin').allowBlank=false;}else{form.findField('username').allowBlank=false;form.findField('user_pin').allowBlank=true;}
if(form.isValid()){var myMask=new Ext.LoadMask(Ext.getCmp('form_supervisor_'+WinIdSpv),{msg:"Verify..."});myMask.show();if(opt_supervisor_pin_mode==0){if(fUsername==''){myMask.hide();ExtApp.Msg.warning('Username / User ID cannot empty!');}
if(verifySpvData.verifyMode==1){if(fPassword==''){myMask.hide();ExtApp.Msg.warning('Password cannot empty!');}}}
Ext.Ajax.request({waitMsg:'Verify...',url:appUrl+'systems/supervisor/verify',method:'POST',params:{verifyMode:verifySpvData.verifyMode,username:fUsername,password:fPassword,user_pin:fUser_pin,access:verifySpvData.access,pin_mode:opt_supervisor_pin_mode,log:verifySpvData.log,data:verifySpvData.data,ref_id_1:verifySpvData.ref_id_1,ref_id_2:verifySpvData.ref_id_2},success:function(response,options){var rsp=Ext.decode(response.responseText);myMask.hide();if(rsp.success==false){ExtApp.Msg.warning(rsp.info);}else{me.WinSupervisor.hide();if(!verifySpvData.spvId){}else
if(verifySpvData.spvId!=''){Ext.getCmp(verifySpvData.spvId).setValue(rsp.confirm.data.user_username);}
if(!verifySpvData.saveBtn){}else
if(verifySpvData.saveBtn!=''){Ext.getCmp(verifySpvData.saveBtn).fireEvent('click');}
me.supervisorConfirm=rsp.confirm;delete me.WinSupervisor;}},failure:function(response,options){var rsp=Ext.decode(response.responseText);ExtApp.Msg.warning(rsp.info);myMask.hide();}});}}});